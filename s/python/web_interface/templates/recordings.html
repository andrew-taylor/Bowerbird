<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="layout.html" />
  <head>
    <title>Recordings</title>
    <style type="text/css">@import url(/media/jscalendar/calendar-blue.css);</style>
    <script type="text/javascript" src="/media/jscalendar/calendar.js"></script>
    <script type="text/javascript" src="/media/jscalendar/lang/calendar-en.js"></script>
    <script type="text/javascript" src="/media/jscalendar/calendar-setup.js"></script>
  </head>
  <body>
    <h1>Recordings</h1>
	<!--! Display any errors -->
	<div py:if="value_of('errors')" class="error">
	    <h2>Errors</h2>
	    <ol>
		<li py:for="error in errors">${error}</li>
	    </ol>
	</div>

	<!--! Display selected recording -->
	<div py:if="value_of('selected_recording')">
	    <h2>Selected Recording
		<a class="clear" href="?set_recording_id=1">[Clear]</a>
	    </h2>
	    <?python from lib.common import compactTimeFormat ?>
	    <table class="selected_recordings">
		<tr>
		<th class="selected_recordings">Title</th>
		<th class="selected_recordings">Date</th>
		<th class="selected_recordings">Time</th>
		<th class="selected_recordings">Actions</th>
		</tr>
		<tr>
		    <td class="selected_recordings">${selected_recording.title}</td>
		    <td class="selected_recordings">
			${selected_recording.start_date.strftime("%d/%m/%y")}</td>
		    <td class="selected_recordings">
			${compactTimeFormat(selected_recording.start_time)} to
			${compactTimeFormat(selected_recording.finish_time)}
		    </td>
		    <td class="selected_recordings">
			<form method="POST" action="?">
			    <input type="hidden" name="recording_id"
				    value="${selected_recording.id}" />
			    <input type="submit" name="set_filter_title"
				    value="Show ${selected_recording.title}" />
			    <input type="submit" name="set_filter_start"
				    value="Set Start" />
			    <input type="submit" name="set_filter_finish"
				    value="Set Finish" />
			    <input type="submit" name="export_recording"
				    value="Export" />
			</form>
		    </td>
		</tr>
	    </table>
	    <hr />
	</div>

	<!--! Display recordings for a selected date -->
	<div py:if="value_of('selected_recordings')">
	    <h2>Recordings for
		${selected_recordings[0].start_date.strftime("%d %B %Y")}
		<a class="clear" href="?clear_selected_date=1">[Clear]</a>
	    </h2>
	    <?python from lib.common import compactTimeFormat ?>
	    <table class="selected_recordings">
		<tr>
		<th class="selected_recordings">Title</th>
		<th class="selected_recordings">Time</th>
		<th class="selected_recordings">Actions</th>
		</tr>
		<tr py:for="rec in selected_recordings">
		    <td class="selected_recordings">${rec.title}</td>
		    <td class="selected_recordings">
			${compactTimeFormat(rec.start_time)} to
			${compactTimeFormat(rec.finish_time)}
		    </td>
		    <td class="selected_recordings">
			<form method="POST" action="?">
			    <input type="hidden" name="recording_id"
				    value="${rec.id}" />
			    <input type="submit" name="set_recording_id"
				    value="Select" />
			    <input type="submit" name="set_filter_title"
				    value="Show ${rec.title}" />
			    <input type="submit" name="set_filter_start"
				    value="Set Start" />
			    <input type="submit" name="set_filter_finish"
				    value="Set Finish" />
			</form>
		    </td>
		</tr>
	    </table>
	    <hr />
	</div>

	<!--! display calendar of recordings -->
	<div>
	    <div class="nav_buttons">
		<form method="POST" action="?">
		    <input type="submit" name="go_to_today" value="Go To Today" />
		    &nbsp; Show:
		    <select py:if="value_of('schedule_titles')" name="filter_title">
			<py:for each="title in schedule_titles" py:choose="">
			    <option py:when="title == filter_title"
				    selected="1">${title}</option>
			    <option py:otherwise="">${title}</option>
			</py:for>
		    </select>
		    &nbsp; Start:
		    <input class="datetime" type="text" id="start"
			    name="filter_start" value="${filter_start}" />
		    <button class="datetime" id="start_trigger">...</button>
		    &nbsp; Finish:
		    <input class="datetime" type="text" id="finish"
			    name="filter_finish" value="${filter_finish}" />
		    <button class="datetime" id="finish_trigger">...</button>
		    <input type="submit" name="update_filter" value="Update" />
		    <input type="submit" name="reset_filter" value="Reset" />
		</form>
		<?python
		    if value_of('selected_recording'):
			default_start = selected_recording.start_time.ctime()
			default_finish = selected_recording.finish_time.ctime()
		    elif value_of('selected_recordings'):
			default_start = selected_recordings[0].start_time.ctime()
			default_finish = selected_recordings[-1].finish_time.ctime()
		    else:
			# leave it blank and calendar will fill in today's date
			default_start = ''
			default_finish = ''
		?>
		<script type="text/javascript">
		  Calendar.setup(
		    {
		      inputField  : "start",         // ID of the input field
		      ifFormat    : "%d/%m/%Y %H:%M",    // the date format
		      button      : "start_trigger",       // ID of the button
		      date        : "${default_start}",
		      showsTime   : true,
		      timeFormat  : "24",
		      singleClick : true,
		      weekNumbers : false,
		      range       : [1900,2999],
		      step        : 1
		    }
		  );
		  Calendar.setup(
		    {
		      inputField  : "finish",         // ID of the input field
		      ifFormat    : "%d/%m/%Y %H:%M",    // the date format
		      button      : "finish_trigger",       // ID of the button
		      date        : "${default_finish}",
		      showsTime   : true,
		      timeFormat  : "24",
		      singleClick : true,
		      weekNumbers : false,
		      range       : [1900,2999],
		      step        : 1
		    }
		  );
		</script>
	    </div>
	    ${calendar}
	</div>
	<p>
	    <form method="post">
		<input type="submit" name="rescan_disk" value="Rescan Disk" />
	    </form>
	</p>
  </body>
</html>
