<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
<xi:include href="layout.html" />
<head>
	<script type="text/javascript">
		// on document load
		$(document).ready(function() {
			// hide all the tables
			$("table.config").hide();

			// add a note explaining how to show tables
			$("a.config_title")
				.after("<span>&lt;-- Click to expand section</span>");

			// set click event on all headings to toggle visibility
			$("a.config_title").click(function(event) {
				// stop any anchor click handling
				event.preventDefault();
				// toggle visibility of note and table (show one and hide the other)
				$(this).next("span").toggle();
				$(this).nextAll("table.config").toggle();
			});
		});
	</script>
	<title>Configuration</title>
</head>

<body>
<h1>Configuration</h1>

<h3 py:if="error" class="error">${error}</h3>

<form name="edit" action="" method="post">

<py:for each="section in values.keys()">
<div py:if="section != 'scheduled_capture'">
	<?python
		from lib.common import META_PREFIX,SECTION_META_PREFIX
		section_id = "unknown_section_id"
		for name in values[section]:
			for (n,sn,id,v,t,u) in values[section][name]:
				section_id = id.split('.')[0]
				break
			break
	?>
	<input type="hidden" name="${SECTION_META_PREFIX}${section_id}" value="${section}" />
	<a class="config_title" href="#">${section}</a>
<br />
<table class="config">
	<tbody>
		<!--! 
			If none of the section has units, then use full width.
			If none of the section has subnames then don't include that column.
		-->
		<?python
			input_class = "config_no_units"
			has_subnames = False
			for name in values[section]:
				for (n,subname,i,v,t,units) in values[section][name]:
					if units: 
						input_class = "config"
					if subname:
						has_subnames = True
		?>
		<py:for each="name in values[section].keys()">
		<tr py:for="i, (n, subname, input_id, value, input_type, units) in enumerate(values[section][name])">
			<td py:if="i == 0" class="config_header" rowspan="${len(values[section][name])}">
				${name}</td>
			<td py:if="has_subnames" class="config_subheader">${subname}</td>
			<td class="config">
				<input type="hidden" name="${META_PREFIX}${input_id}" 
					value="${name},${subname},${input_type},${units}" />
				<input class="${input_class}" name="${input_id}" 
						type="text" value="${value}"/>${units}
			</td>
		</tr>
		</py:for>
	</tbody>
</table>
</div>
</py:for>

<p>
<!--! only show load defaults button if defaults file has been specified -->
<input py:if="defaults_file" name="load_defaults" value="Load Defaults" type="submit" />
<input name="cancel" value="Cancel" type="submit" />
<input name="apply" value="Apply Changes" type="submit" /> 
</p>

<p>
Current values are stored in "${file}".<br/>
<py:if test="defaults_file">
To update the defaults, change the values in "${defaults_file}".<br/>
</py:if>
To change the descriptions of the sections &amp; parameters, edit the
comments in the config file (following examples &amp; descriptions
within).
</p>
</form>

<p>
<form name="export" action="" method="post">
To save the current configuration, click on this button.
<br />
<input name="export_config" value="Export Current Config" type="submit" />
</form>
</p>

<p>
<form name="import" action="" method="post" enctype="multipart/form-data">
To upload a new configuration, choose the file below, and click the Import button.
<br />
<strong>Note</strong>: This will just upload the config. You need to click the
"Apply Changes" button (on the next page) to actually save the new values.
<input name="new_config" type="file" />
<input name="import_config" value="Import New Config" type="submit" />
</form>
</p>
</body>
</html>
