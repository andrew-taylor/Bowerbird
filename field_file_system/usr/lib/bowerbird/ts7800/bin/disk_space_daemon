#!/bin/sh
trap ''  1 2 3 7 13 15
. /etc/bowerbird/config/global_variables
set -x
exec >>$log_dir/disk_space_daemon 2>&1
while true
do
	df=`df $data_dir|sed '1d;s/%.*//;s/.* //'`
	echo "du:$df%" >$status_dir/disk.message
	if test -r /tmp/accelerated_testing
	then
		acceleration=`cat /tmp/accelerated_testing`
		df=$(((df + 1) * acceleration))
	fi
	if test "$df" -lt 95
	then
		sleep 5000
		continue
	elif test "$df" -lt 99
	then
		sleep 120
		continue
	fi
#	rm -f /tmp/*.output
	find $data_dir -name '*.wv'|sort -t@ -k2|sed 150q|xargs -r rm
	sleep 60
done
